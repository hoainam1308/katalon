name: Katalon CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
      
    - name: Set up JDK
      uses: actions/setup-java@v2
      with:
        java-version: '8'
        distribution: 'adopt'
        
    - name: Download Katalon Studio
      run: |
        wget -qO katalon.zip https://download.katalon.com/${{ secrets.KATALON_VERSION }}/Katalon_Studio_Linux_64-${{ secrets.KATALON_VERSION }}.zip
        unzip -qq katalon.zip -d katalon
        chmod +x katalon/Katalon_Studio_Linux_64-${{ secrets.KATALON_VERSION }}/katalon
        
    - name: Run Katalon tests
      run: |
        cd katalon/Katalon_Studio_Linux_64-${{ secrets.KATALON_VERSION }}
        ./katalon -noSplash -runMode=console -projectPath="${{ github.workspace }}" -retry=0 -testSuitePath="Test Suites/Your_Test_Suite" -browserType="Chrome" -apiKey=${{ secrets.KATALON_API_KEY }} -orgID=${{ secrets.KATALON_ORG_ID }}
        
    - name: Upload test reports
      uses: actions/upload-artifact@v2
      if: always()
      with:
        name: test-reports
        path: Reports/