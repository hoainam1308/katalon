name: Katalon CI/CD

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  katalon-test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Install Katalon Runtime Engine
        run: |
          wget https://download.katalon.com/katalon-studio/8.6.5/Katalon_Studio_Engine_Linux_64-8.6.5.tar.gz # Thay đổi phiên bản nếu cần
          tar -xzf Katalon_Studio_Engine_Linux_64-8.6.5.tar.gz
          sudo mv katalon /opt/

      - name: Run Katalon Tests
        env:
          KATALON_API_KEY: ${{ secrets.KATALON_API_KEY }}  # Nếu bạn sử dụng Katalon TestOps
          LICENSE_KEY: ${{ secrets.KATALON_LICENSE_KEY }}  # Nếu bạn có License
        run: |
          export DISPLAY=:99
          sh -e /opt/katalon/katalon --consoleLog -noSplash -runMode=console \
            -projectPath="${{ github.workspace }}/TestLogin.prj" \ # Thay đổi đường dẫn đến project của bạn
            -testSuiteCollectionPath="Test Suites/Test_Suite_Login" \ # Thay đổi đường dẫn đến test suite collection
            -executionProfile="default" \ # Thay đổi profile nếu cần
            -browserType="Chrome" \ # Thay đổi browser nếu cần
            ${{ secrets.KATALON_LICENSE_KEY != '' && format('--apiKey={0}', secrets.KATALON_LICENSE_KEY) || '' }} \ # Thêm license key nếu có
            -reportFolder="reports" \ # Nơi lưu trữ báo cáo
            -retry=0 \
            -testOpsMode=true

      - name: Upload Test Report
        uses: actions/upload-artifact@v3
        with:
          name: Katalon Test Report
          path: "Reports"